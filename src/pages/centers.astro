---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Find Treatment Centers">
  <section class="centers-header">
    <div class="container">
      <h1>Addiction Help Facilities Directory</h1>
      <p>Browse all facilities that help people with addiction recovery</p>
    </div>
  </section>

  <section class="about-centers">
    <div class="container">
      <div class="about-container">
        <div class="about-content">
          <h2>Facilities That Help People Recover</h2>
          <p>Finding support during recovery is essential. Our directory includes all types of facilities that help people overcome addiction and rebuild their lives. We focus on making all options available to those seeking help.</p>
          <p>These facilities offer a variety of support services including detox, residential care, outpatient programs, therapy, counseling, and ongoing recovery support. Each provides unique approaches to helping people on their journey to wellness and sobriety.</p>
        </div>
        <div class="about-image">
          <img src="/images/hero-placeholder.svg" alt="Treatment Center" />
        </div>
      </div>
    </div>
  </section>

  <section class="search-section">
    <div class="container">
      <div class="search-container">
        <h2>View All Support Facilities</h2>
        <p>All facilities that help people with addiction recovery are shown below:</p>
        <form id="search-form">
          <div class="search-fields">
            <div class="form-group">
              <label for="location">Search (Optional)</label>
              <div class="input-with-button">
                <input type="text" id="location" placeholder="Enter any search term">
                <button type="button" id="use-location" class="location-btn">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                  </svg>
                </button>
              </div>
            </div>
            <div class="form-group">
              <label for="sort">Sort by</label>
              <select id="sort">
                <option value="distance" selected>Distance (Closest first)</option>
                <option value="rating">Rating (Highest first)</option>
                <option value="name">Name (A-Z)</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn btn-primary search-btn">Apply Sorting</button>
        </form>
      </div>
    </div>
  </section>

  <section class="results-section">
    <div class="container">
      <h2>All Facilities That Help People</h2>
      
      <div class="search-message">
        <p>Showing all facilities that help people with addiction recovery, sorted by distance from Austin, TX.</p>
      </div>
      
      <div class="centers-list">
        <!-- Hard-coded centers that will always display -->
        <div class="center-card">
          <div class="center-header">
            <h3>Recovery Unplugged - Austin</h3>
            <div class="center-rating">
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star half-filled">★</span>
              <span class="rating-value">4.8</span>
            </div>
          </div>
          <div class="center-location">
            <p>1908 S 1st St, Austin, TX 78704</p>
            <p class="distance">0.0 miles away</p>
          </div>
          <div class="center-details">
            <div class="detail-group">
              <h4>Specialties</h4>
              <p>Music Therapy, Dual Diagnosis, Detox</p>
            </div>
            <div class="detail-group">
              <h4>Insurance Accepted</h4>
              <p>Aetna, Blue Cross, Cigna, Medicare</p>
            </div>
          </div>
          <div class="center-contact">
            <a href="tel:(512) 522-7724" class="phone-link">(512) 522-7724</a>
            <a href="https://www.recoveryunplugged.com/locations/austin/" target="_blank" class="website-link">Visit Website</a>
          </div>
          <a href="/reviews?center=1" class="btn btn-secondary view-reviews">Read Reviews</a>
        </div>

        <div class="center-card">
          <div class="center-header">
            <h3>Serenity Wellness Center</h3>
            <div class="center-rating">
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star half-filled">★</span>
              <span class="rating-value">4.7</span>
            </div>
          </div>
          <div class="center-location">
            <p>1530 High St, Denver, CO 80218</p>
            <p class="distance">770.1 miles away</p>
          </div>
          <div class="center-details">
            <div class="detail-group">
              <h4>Specialties</h4>
              <p>Holistic Therapy, Trauma Therapy, CBT</p>
            </div>
            <div class="detail-group">
              <h4>Insurance Accepted</h4>
              <p>Blue Cross, United Healthcare, Cigna, Aetna</p>
            </div>
          </div>
          <div class="center-contact">
            <a href="tel:(303) 555-8725" class="phone-link">(303) 555-8725</a>
            <a href="https://example.com/serenity" target="_blank" class="website-link">Visit Website</a>
          </div>
          <a href="/reviews?center=2" class="btn btn-secondary view-reviews">Read Reviews</a>
        </div>

        <div class="center-card">
          <div class="center-header">
            <h3>New Beginnings Recovery</h3>
            <div class="center-rating">
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="rating-value">4.9</span>
            </div>
          </div>
          <div class="center-location">
            <p>4233 N 12th St, Phoenix, AZ 85014</p>
            <p class="distance">868.5 miles away</p>
          </div>
          <div class="center-details">
            <div class="detail-group">
              <h4>Specialties</h4>
              <p>Dual Diagnosis, Family Therapy, Aftercare</p>
            </div>
            <div class="detail-group">
              <h4>Insurance Accepted</h4>
              <p>Aetna, Blue Cross, Humana, Medicare</p>
            </div>
          </div>
          <div class="center-contact">
            <a href="tel:(602) 555-3349" class="phone-link">(602) 555-3349</a>
            <a href="https://example.com/newbeginnings" target="_blank" class="website-link">Visit Website</a>
          </div>
          <a href="/reviews?center=3" class="btn btn-secondary view-reviews">Read Reviews</a>
        </div>

        <div class="center-card">
          <div class="center-header">
            <h3>Coastal Healing Center</h3>
            <div class="center-rating">
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star half-filled">★</span>
              <span class="rating-value">4.5</span>
            </div>
          </div>
          <div class="center-location">
            <p>2103 Coral Way, Miami, FL 33145</p>
            <p class="distance">1186.3 miles away</p>
          </div>
          <div class="center-details">
            <div class="detail-group">
              <h4>Specialties</h4>
              <p>Mindfulness, Group Therapy, Relapse Prevention</p>
            </div>
            <div class="detail-group">
              <h4>Insurance Accepted</h4>
              <p>Cigna, Aetna, Blue Cross, Medicare</p>
            </div>
          </div>
          <div class="center-contact">
            <a href="tel:(305) 555-1290" class="phone-link">(305) 555-1290</a>
            <a href="https://example.com/coastalhealing" target="_blank" class="website-link">Visit Website</a>
          </div>
          <a href="/reviews?center=4" class="btn btn-secondary view-reviews">Read Reviews</a>
        </div>

        <div class="center-card">
          <div class="center-header">
            <h3>Recovery Pathways Center</h3>
            <div class="center-rating">
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="rating-value">4.8</span>
            </div>
          </div>
          <div class="center-location">
            <p>2750 N Lake Shore Dr, Chicago, IL 60614</p>
            <p class="distance">978.6 miles away</p>
          </div>
          <div class="center-details">
            <div class="detail-group">
              <h4>Specialties</h4>
              <p>Trauma-Informed Care, Medication-Assisted, Cognitive Therapy</p>
            </div>
            <div class="detail-group">
              <h4>Insurance Accepted</h4>
              <p>Blue Cross, Aetna, Cigna, United Healthcare</p>
            </div>
          </div>
          <div class="center-contact">
            <a href="tel:(312) 555-9087" class="phone-link">(312) 555-9087</a>
            <a href="https://example.com/recoverypathways" target="_blank" class="website-link">Visit Website</a>
          </div>
          <a href="/reviews?center=5" class="btn btn-secondary view-reviews">Read Reviews</a>
        </div>

        <div class="center-card">
          <div class="center-header">
            <h3>Harmony Treatment Services</h3>
            <div class="center-rating">
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star half-filled">★</span>
              <span class="rating-value">4.6</span>
            </div>
          </div>
          <div class="center-location">
            <p>1507 16th Ave S, Nashville, TN 37212</p>
            <p class="distance">675.8 miles away</p>
          </div>
          <div class="center-details">
            <div class="detail-group">
              <h4>Specialties</h4>
              <p>Music Therapy, Individual Counseling, Outpatient</p>
            </div>
            <div class="detail-group">
              <h4>Insurance Accepted</h4>
              <p>Aetna, Blue Cross, Cigna, United Healthcare</p>
            </div>
          </div>
          <div class="center-contact">
            <a href="tel:(615) 555-6378" class="phone-link">(615) 555-6378</a>
            <a href="https://example.com/harmony" target="_blank" class="website-link">Visit Website</a>
          </div>
          <a href="/reviews?center=6" class="btn btn-secondary view-reviews">Read Reviews</a>
        </div>

        <div class="center-card">
          <div class="center-header">
            <h3>Sunrise Recovery Center</h3>
            <div class="center-rating">
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star filled">★</span>
              <span class="star half-filled">★</span>
              <span class="rating-value">4.7</span>
            </div>
          </div>
          <div class="center-location">
            <p>1818 Eastlake Ave E, Seattle, WA 98102</p>
            <p class="distance">2097.2 miles away</p>
          </div>
          <div class="center-details">
            <div class="detail-group">
              <h4>Specialties</h4>
              <p>Wilderness Therapy, Co-occurring Disorders, Residential</p>
            </div>
            <div class="detail-group">
              <h4>Insurance Accepted</h4>
              <p>Blue Cross, Cigna, United Healthcare, Kaiser</p>
            </div>
          </div>
          <div class="center-contact">
            <a href="tel:(206) 555-7214" class="phone-link">(206) 555-7214</a>
            <a href="https://example.com/sunrise" target="_blank" class="website-link">Visit Website</a>
          </div>
          <a href="/reviews?center=7" class="btn btn-secondary view-reviews">Read Reviews</a>
        </div>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const searchForm = document.getElementById('search-form');
      const useLocationBtn = document.getElementById('use-location');
      const sortSelect = document.getElementById('sort');
      const centersList = document.querySelector('.centers-list');
      const centers = Array.from(document.querySelectorAll('.center-card'));
      
      // Function to sort centers by different criteria
      function sortCenters(criteria) {
        try {
          // Update the search message based on sort criteria
          const searchMessage = document.querySelector('.search-message p');
          if (searchMessage) {
            if (criteria === 'distance') {
              searchMessage.textContent = 'Showing all facilities that help people with addiction recovery, sorted by distance from Austin, TX.';
            } else if (criteria === 'rating') {
              searchMessage.textContent = 'Showing all facilities that help people with addiction recovery, sorted by highest rating.';
            } else if (criteria === 'name') {
              searchMessage.textContent = 'Showing all facilities that help people with addiction recovery, sorted alphabetically by name.';
            }
          }
          
          // Remove all centers from the DOM
          centers.forEach(center => {
            try {
              centersList.removeChild(center);
            } catch (e) {
              console.log('Error removing center, continuing anyway');
            }
          });
          
          // Sort based on the selected criteria
          centers.sort((a, b) => {
            if (criteria === 'distance') {
              // Sort by location (Austin first, then others alphabetically)
              const locationA = a.querySelector('.center-location p').textContent || '';
              const locationB = b.querySelector('.center-location p').textContent || '';
              
              // Put Austin first
              if (locationA.includes('Austin') && !locationB.includes('Austin')) return -1;
              if (!locationA.includes('Austin') && locationB.includes('Austin')) return 1;
              
              // Then sort alphabetically by city
              return locationA.localeCompare(locationB);
            } 
            else if (criteria === 'rating') {
              // Sort by rating (highest first)
              const ratingA = parseFloat(a.querySelector('.rating-value').textContent || '0');
              const ratingB = parseFloat(b.querySelector('.rating-value').textContent || '0');
              return ratingB - ratingA;
            } 
            else if (criteria === 'name') {
              // Sort alphabetically by name
              const nameA = a.querySelector('h3').textContent || '';
              const nameB = b.querySelector('h3').textContent || '';
              return nameA.localeCompare(nameB);
            }
            return 0;
          });
          
          // Add sorted centers back to the DOM
          centers.forEach(center => centersList.appendChild(center));
        } catch (error) {
          console.error('Error sorting centers:', error);
          // If sorting fails, make sure all centers are at least displayed
          centers.forEach(center => {
            try {
              if (!centersList.contains(center)) {
                centersList.appendChild(center);
              }
            } catch (e) {
              console.error('Error re-adding center:', e);
            }
          });
        }
      }
      
      // Handle sort selection change
      if (sortSelect) {
        sortSelect.addEventListener('change', function() {
          sortCenters(this.value);
        });
        
        // Initial sort
        sortCenters('distance');
      }
      
      // Handle form submission
      if (searchForm) {
        searchForm.addEventListener('submit', function(event) {
          event.preventDefault();
          // Re-sort the centers based on current selection
          sortCenters(sortSelect.value);
        });
      }
      
      // Handle "Use My Location" button
      if (useLocationBtn) {
        useLocationBtn.addEventListener('click', function() {
          document.getElementById('location').value = 'My Location';
          // Simulate searching from Austin
          sortCenters('distance');
        });
      }
    });
  </script>

  <style>
    /* Header styles */
    .centers-header {
      background-color: var(--color-background);
      padding: 3rem 0;
      text-align: center;
      border-bottom: 1px solid #eaeaea;
    }

    .centers-header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      color: var(--color-text);
    }

    .centers-header p {
      font-size: 1.2rem;
      color: var(--color-text-light);
      max-width: 600px;
      margin: 0 auto;
    }

    /* Search section styles */
    .search-section {
      padding:.5rem 0 2rem;
      background-color: white;
      border-bottom: 1px solid #eaeaea;
    }

    .search-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 1.5rem;
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .search-fields {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .form-group {
      margin-bottom: 0.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--color-text);
    }

    .input-with-button {
      display: flex;
      position: relative;
    }

    .input-with-button input {
      flex: 1;
      padding-right: 40px;
    }

    .location-btn {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      background: none;
      border: none;
      padding: 0 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--color-primary);
    }

    .location-btn svg {
      width: 20px;
      height: 20px;
    }

    input, select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #e1e1e1;
      border-radius: var(--border-radius);
      font-family: var(--font-sans);
      font-size: 1rem;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }

    .search-btn {
      width: 100%;
      padding: 0.75rem;
    }

    /* Results section styles */
    .results-section {
      padding: 3rem 0;
      background-color: #f9f9f9;
    }

    .results-section h2 {
      margin-bottom: 1.5rem;
      font-size: 1.75rem;
      color: var(--color-text);
    }

    .centers-list {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .search-message {
      background-color: #f8f9fa;
      border-left: 4px solid var(--color-primary);
      text-align: left;
      padding: 1rem 1.5rem;
      margin-bottom: 1.5rem;
      border-radius: var(--border-radius);
    }

    /* Center card styles */
    .center-card {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .center-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .center-header h3 {
      font-size: 1.25rem;
      color: var(--color-text);
      margin: 0;
    }

    .center-rating {
      display: flex;
      align-items: center;
      color: var(--color-text);
    }

    .star {
      color: #ccc;
      margin-right: 2px;
    }

    .star.filled {
      color: var(--color-accent);
    }

    .star.half-filled {
      position: relative;
      color: #ccc;
    }

    .star.half-filled::before {
      content: "★";
      position: absolute;
      color: var(--color-accent);
      width: 50%;
      overflow: hidden;
    }

    .rating-value {
      margin-left: 0.5rem;
      font-weight: 500;
    }

    .center-location {
      margin-bottom: 1rem;
      color: var(--color-text-light);
    }

    .center-location p {
      margin: 0;
    }
    
    .distance {
      margin-top: 0.25rem;
      font-weight: 500;
      color: var(--color-primary);
      display: block !important;
    }

    .center-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .detail-group h4 {
      font-size: 1rem;
      margin: 0 0 0.5rem 0;
      color: var(--color-text);
    }

    .detail-group p {
      margin: 0;
      color: var(--color-text-light);
      font-size: 0.9rem;
    }

    .center-contact {
      display: flex;
      margin-bottom: 1rem;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .phone-link, .website-link {
      color: var(--color-primary);
      text-decoration: none;
      font-weight: 500;
    }

    .view-reviews {
      display: inline-block;
      width: auto;
    }

    .about-centers {
      padding: 2rem 0;
      background-color: white;
    }
    
    .about-container {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 2rem;
      background-color: #f8f9fa;
      border-radius: var(--border-radius);
      padding: 2rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    
    .about-content h2 {
      margin-bottom: 1rem;
      color: var(--color-text);
    }
    
    .about-content p {
      margin-bottom: 1rem;
      color: var(--color-text-light);
    }
    
    .about-image img {
      width: 100%;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    @media (max-width: 768px) {
      .container {
        padding-left: 2.5rem !important;
        padding-right: 2.5rem !important;
      }
      
      .search-fields {
        grid-template-columns: 1fr;
      }
      
      .center-details {
        grid-template-columns: 1fr;
      }
      
      .center-header {
        flex-direction: column;
      }
      
      .center-rating {
        margin-top: 0.5rem;
      }
      
      .about-container {
        grid-template-columns: 1fr;
        padding: 1.5rem;
      }
      
      .about-image {
        margin-top: 1rem;
      }
    }
  </style>
</Layout>